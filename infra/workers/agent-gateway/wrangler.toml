# =============================================================================
# AIMS Agent Gateway Worker
# =============================================================================
# Edge-level agent detection, request routing, and response caching.
# Sits in front of the VPS origin and handles:
#   - Agent request detection (Accept: text/markdown, user-agent sniffing)
#   - LLM.txt / AI Index caching at the edge (no origin hit)
#   - Plug instance routing (subdomain → port mapping via KV)
#   - Rate limiting per API key / IP
#   - CORS and security headers
#
# Deploy: cd infra/workers/agent-gateway && npx wrangler deploy
# Dev:    cd infra/workers/agent-gateway && npx wrangler dev
# =============================================================================

name = "aims-agent-gateway"
main = "src/index.ts"
compatibility_date = "2024-12-18"

# Custom domain routing — sits in front of plugmein.cloud
# Uncomment after initial deploy + DNS setup:
# routes = [
#   { pattern = "plugmein.cloud/llm.txt", zone_name = "plugmein.cloud" },
#   { pattern = "plugmein.cloud/llm-full.txt", zone_name = "plugmein.cloud" },
#   { pattern = "plugmein.cloud/ai-index.json", zone_name = "plugmein.cloud" },
#   { pattern = "plugmein.cloud/.well-known/*", zone_name = "plugmein.cloud" },
#   { pattern = "*.plugmein.cloud/*", zone_name = "plugmein.cloud" },
# ]

# KV namespace for plug instance routing table (subdomain → port)
# Create with: npx wrangler kv namespace create PLUG_ROUTES
# Then paste the ID below:
# [[kv_namespaces]]
# binding = "PLUG_ROUTES"
# id = "<your-kv-namespace-id>"

# Cache API is available by default — no binding needed

[vars]
ENVIRONMENT = "production"
ORIGIN_URL = "https://plugmein.cloud"
VPS_IP = "76.13.96.107"
