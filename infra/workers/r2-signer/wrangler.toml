# =============================================================================
# AIMS R2 Signer Worker
# =============================================================================
# Generates presigned URLs for R2 objects (export bundles, artifacts).
# Called by the UEF Gateway when clients need download links.
#
# Deploy: cd infra/workers/r2-signer && npx wrangler deploy
# Dev:    cd infra/workers/r2-signer && npx wrangler dev
# =============================================================================

name = "aims-r2-signer"
main = "src/index.ts"
compatibility_date = "2024-12-18"

# R2 bucket binding — the Worker gets direct access to the bucket
[[r2_buckets]]
binding = "EXPORTS_BUCKET"
bucket_name = "aims-exports"

# Environment variables (set via `wrangler secret put`)
# SIGNING_SECRET — shared secret between UEF Gateway and this Worker
# Validates that requests actually come from our gateway, not random callers.

[vars]
ENVIRONMENT = "production"
ALLOWED_ORIGIN = "https://plugmein.cloud"

# Rate limiting — prevent abuse of signed URL generation
# [unsafe.bindings]
# Not needed for initial deploy; add if abuse becomes an issue
