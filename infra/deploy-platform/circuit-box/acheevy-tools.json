{
  "$schema": "https://aims.dev/schemas/acheevy-tools.json",
  "name": "ACHEEVY Tool Registry",
  "version": "1.0.0",
  "description": "Tools available to ACHEEVY for dispatching work to the Deploy Platform",

  "governance_chain": {
    "description": "Enforced command hierarchy for all tool executions",
    "chain": ["ACHEEVY", "Boomer_Ang", "Chicken Hawk", "Squad", "Lil_Hawks"],
    "rules": [
      "ACHEEVY approves plan and presents to user",
      "Boomer_Ang validates scope against DSP limits",
      "Contract issued to Chicken Hawk with ShiftId",
      "Chicken Hawk spawns Squad with Lil_Hawks",
      "Lil_Hawks execute and report to Chicken Hawk",
      "Chicken Hawk reports to ACHEEVY",
      "ACHEEVY verifies receipt and closes with user"
    ]
  },

  "tools": {
    "deploy_it": {
      "name": "deploy_it",
      "description": "Fast dispatch lane - pre-approved operations with low OEI",
      "category": "deploy",
      "parameters": {
        "type": "object",
        "required": ["project_id", "manifest"],
        "properties": {
          "project_id": {"type": "string", "description": "Target project identifier"},
          "manifest": {"$ref": "#/definitions/manifest"},
          "environment": {"type": "string", "enum": ["staging", "production"], "default": "staging"}
        }
      },
      "requirements": {
        "dsp_gates": "pre-approved",
        "oei": "low",
        "new_integrations": false,
        "secrets_scope_expansion": false
      },
      "dispatch_to": "Chicken Hawk",
      "user_experience": "Watch the crew work, get receipt"
    },

    "guide_me": {
      "name": "guide_me",
      "description": "Consultative lane - requires manifest approval before execution",
      "category": "deploy",
      "parameters": {
        "type": "object",
        "required": ["project_id", "request_description"],
        "properties": {
          "project_id": {"type": "string"},
          "request_description": {"type": "string"},
          "uncertainty_factors": {"type": "array", "items": {"type": "string"}}
        }
      },
      "triggers": [
        "uncertainty_high",
        "security_packet_requires_hold",
        "new_integrations",
        "production_impact",
        "secrets_scope_expansion",
        "anomaly_detected"
      ],
      "dispatch_to": "Chicken Hawk",
      "output": "Manifest for approval, then execution proceeds"
    },

    "spawn_shift": {
      "name": "spawn_shift",
      "description": "Create a new Shift with Squad and Lil_Hawks",
      "category": "orchestration",
      "parameters": {
        "type": "object",
        "required": ["manifest", "dsp"],
        "properties": {
          "manifest": {"$ref": "#/definitions/manifest"},
          "dsp": {"$ref": "#/definitions/dsp_reference"},
          "squad_size": {"type": "integer", "minimum": 1, "maximum": 12, "default": 4},
          "crew_specialties": {"type": "array", "items": {"type": "string"}}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "returns": {
        "shift_id": "string",
        "squad_id": "string",
        "lil_hawk_designations": "string[]",
        "estimated_waves": "integer"
      }
    },

    "execute_wave": {
      "name": "execute_wave",
      "description": "Execute a single wave of operations within a Shift",
      "category": "execution",
      "parameters": {
        "type": "object",
        "required": ["shift_id", "wave_number", "steps"],
        "properties": {
          "shift_id": {"type": "string"},
          "wave_number": {"type": "integer"},
          "steps": {"type": "array", "items": {"$ref": "#/definitions/wave_step"}}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "returns": {
        "wave_result": "success | partial | failed",
        "steps_completed": "integer",
        "steps_failed": "integer",
        "anomalies": "object[]"
      }
    },

    "verify_shift": {
      "name": "verify_shift",
      "description": "Run verification phase for a completed Shift",
      "category": "verification",
      "parameters": {
        "type": "object",
        "required": ["shift_id"],
        "properties": {
          "shift_id": {"type": "string"},
          "verification_level": {"type": "string", "enum": ["standard", "deep", "oracle"], "default": "standard"}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "returns": {
        "verification_passed": "boolean",
        "attestation_bundle": "object",
        "discrepancies": "object[]"
      }
    },

    "seal_receipt": {
      "name": "seal_receipt",
      "description": "Finalize Shift and generate sealed receipt",
      "category": "audit",
      "parameters": {
        "type": "object",
        "required": ["shift_id"],
        "properties": {
          "shift_id": {"type": "string"}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "returns": {
        "receipt_id": "string",
        "receipt_hash": "string",
        "kyb_flight_recorder_pointer": "string",
        "final_metrics": "object"
      }
    },

    "get_shift_status": {
      "name": "get_shift_status",
      "description": "Get current status of an active Shift",
      "category": "monitoring",
      "parameters": {
        "type": "object",
        "required": ["shift_id"],
        "properties": {
          "shift_id": {"type": "string"},
          "include_captions": {"type": "boolean", "default": true}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "returns": {
        "phase": "string",
        "progress_percent": "number",
        "current_wave": "integer",
        "lil_hawk_statuses": "object[]",
        "recent_captions": "string[]"
      }
    },

    "trigger_rollback": {
      "name": "trigger_rollback",
      "description": "Initiate rollback for a Shift",
      "category": "safety",
      "parameters": {
        "type": "object",
        "required": ["shift_id", "reason"],
        "properties": {
          "shift_id": {"type": "string"},
          "reason": {"type": "string"},
          "rollback_to": {"type": "string", "description": "Target state reference"}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "requires_confirmation": true,
      "returns": {
        "rollback_initiated": "boolean",
        "estimated_duration_ms": "integer"
      }
    },

    "emergency_kill_switch": {
      "name": "emergency_kill_switch",
      "description": "Immediately halt all Lil_Hawk operations in a Shift",
      "category": "safety",
      "parameters": {
        "type": "object",
        "required": ["shift_id", "reason"],
        "properties": {
          "shift_id": {"type": "string"},
          "reason": {"type": "string"}
        }
      },
      "dispatch_to": "Chicken Hawk",
      "requires_confirmation": true,
      "audit_required": true,
      "returns": {
        "killed": "boolean",
        "lil_hawks_terminated": "integer",
        "state_preserved": "boolean"
      }
    },

    "start_factory_run": {
      "name": "start_factory_run",
      "description": "Initiate an FDH pipeline from an event or user 'Manage It' request",
      "category": "factory",
      "parameters": {
        "type": "object",
        "required": ["scope"],
        "properties": {
          "scope": {"type": "string", "description": "What needs to be done"},
          "chamber_id": {"type": "string", "description": "Target chamber (auto-created if omitted)"},
          "priority": {"type": "string", "enum": ["standard", "priority", "urgent"], "default": "standard"},
          "event_source": {"type": "string", "enum": ["git", "spec", "ticket", "telemetry", "schedule", "user", "build", "deploy", "automation"], "default": "user"}
        }
      },
      "dispatch_to": "Factory Controller",
      "returns": {
        "run_id": "string",
        "manifest_id": "string",
        "awaiting_approval": "boolean",
        "estimated_cost_usd": "number"
      }
    },

    "oversee_factory_run": {
      "name": "oversee_factory_run",
      "description": "Monitor an active FDH run — check progress, detect stalls",
      "category": "factory",
      "parameters": {
        "type": "object",
        "required": ["run_id"],
        "properties": {
          "run_id": {"type": "string"},
          "delegate_to": {"type": "string", "description": "Boomer_Ang to delegate oversight (e.g. OpsConsole_Ang)"}
        }
      },
      "dispatch_to": "Factory Controller",
      "returns": {
        "status": "string",
        "phase": "string",
        "progress": "object",
        "oracle_score": "number"
      }
    },

    "approve_fdh_run": {
      "name": "approve_fdh_run",
      "description": "Approve a pending FDH manifest (HITL gate in Guide Me lane)",
      "category": "factory",
      "parameters": {
        "type": "object",
        "required": ["run_id"],
        "properties": {
          "run_id": {"type": "string"}
        }
      },
      "dispatch_to": "Factory Controller",
      "requires_confirmation": true,
      "returns": {
        "approved": "boolean",
        "run_id": "string",
        "status": "string"
      }
    },

    "factory_status_report": {
      "name": "factory_status_report",
      "description": "Generate factory status report — active runs, costs, completions",
      "category": "factory",
      "parameters": {
        "type": "object",
        "properties": {
          "include_chambers": {"type": "boolean", "default": true},
          "include_recent": {"type": "boolean", "default": true}
        }
      },
      "dispatch_to": "Factory Controller",
      "returns": {
        "factory_enabled": "boolean",
        "status": "string",
        "active_fdh_runs": "integer",
        "pending_approvals": "integer",
        "period_cost": "object",
        "recent_completions": "object[]"
      }
    },

    "pause_factory": {
      "name": "pause_factory",
      "description": "Temporarily halt all factory operations",
      "category": "factory",
      "parameters": {
        "type": "object",
        "properties": {
          "reason": {"type": "string"}
        }
      },
      "dispatch_to": "Factory Controller",
      "requires_confirmation": true,
      "returns": {
        "paused": "boolean"
      }
    },

    "resume_factory": {
      "name": "resume_factory",
      "description": "Resume factory operations after pause",
      "category": "factory",
      "parameters": {
        "type": "object",
        "properties": {}
      },
      "dispatch_to": "Factory Controller",
      "returns": {
        "resumed": "boolean"
      }
    },

    "set_factory_policy": {
      "name": "set_factory_policy",
      "description": "Update Circuit Box factory policy (owner only)",
      "category": "factory",
      "parameters": {
        "type": "object",
        "properties": {
          "auto_approve_threshold_usd": {"type": "number"},
          "max_concurrent_fdh": {"type": "integer"},
          "hours": {"type": "string", "enum": ["always", "business", "custom"]},
          "stall_timeout_minutes": {"type": "integer"},
          "monthly_budget_cap_usd": {"type": "number"},
          "event_sources": {"type": "array", "items": {"type": "string"}},
          "auto_wire_enabled": {"type": "boolean"},
          "health_remediation": {"type": "string", "enum": ["restart_then_scale", "alert_only", "auto_scale"]}
        }
      },
      "dispatch_to": "Factory Controller",
      "requires_confirmation": true,
      "returns": {
        "updated": "boolean",
        "policy": "object"
      }
    }
  },

  "definitions": {
    "manifest": {
      "type": "object",
      "required": ["name", "capabilities", "target"],
      "properties": {
        "name": {"type": "string"},
        "description": {"type": "string"},
        "capabilities": {"type": "array", "items": {"type": "string"}},
        "target": {
          "type": "object",
          "properties": {
            "environment": {"type": "string"},
            "resource_group": {"type": "string"}
          }
        },
        "waves": {
          "type": "array",
          "items": {"$ref": "#/definitions/wave_definition"}
        }
      }
    },
    "wave_definition": {
      "type": "object",
      "properties": {
        "wave_number": {"type": "integer"},
        "steps": {"type": "array", "items": {"$ref": "#/definitions/wave_step"}},
        "parallel": {"type": "boolean", "default": false}
      }
    },
    "wave_step": {
      "type": "object",
      "required": ["capability_id", "action"],
      "properties": {
        "capability_id": {"type": "string"},
        "action": {"type": "string"},
        "params": {"type": "object"},
        "assigned_lil_hawk": {"type": "string"}
      }
    },
    "dsp_reference": {
      "type": "object",
      "required": ["packet_id"],
      "properties": {
        "packet_id": {"type": "string", "pattern": "^DSP-[A-Z0-9]{8}$"},
        "status": {"type": "string", "enum": ["approved", "active"]}
      }
    }
  },

  "capability_to_crew_mapping": {
    "description": "Which Lil_Hawk types handle which capabilities",
    "crane_ops": {
      "lil_hawks": ["Lil_Popeye_Hawk", "Lil_IronWing_Hawk", "Lil_StackMaster_Hawk", "Lil_Lifter_Hawk"],
      "capabilities": ["infrastructure_deploy", "database_migration", "heavy_compute"]
    },
    "load_ops": {
      "lil_hawks": ["Lil_Busy_Hawk", "Lil_Scurry_Hawk", "Lil_Parcel_Hawk", "Lil_Hauler_Hawk"],
      "capabilities": ["file_operations", "data_transfer", "config_updates"]
    },
    "deploy_ops": {
      "lil_hawks": ["Lil_Packer_Hawk", "Lil_ShipIt_Hawk", "Lil_Rollout_Hawk", "Lil_Seal_Hawk"],
      "capabilities": ["container_build", "artifact_publish", "deployment_execute"]
    },
    "safety_ops": {
      "lil_hawks": ["Lil_RedFlag_Hawk", "Lil_Seatbelt_Hawk", "Lil_WhoaThere_Hawk", "Lil_Guardian_Hawk"],
      "capabilities": ["security_scan", "anomaly_detection", "compliance_check"]
    },
    "yard_ops": {
      "lil_hawks": ["Lil_LaneBoss_Hawk", "Lil_Tetris_Hawk", "Lil_Pathfinder_Hawk", "Lil_Router_Hawk"],
      "capabilities": ["routing", "load_balancing", "resource_allocation"]
    },
    "dispatch_ops": {
      "lil_hawks": ["Lil_Dispatch_Hawk", "Lil_Wave_Hawk", "Lil_Sync_Hawk", "Lil_Tempo_Hawk"],
      "capabilities": ["orchestration", "scheduling", "coordination"]
    }
  }
}
